<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Compass.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Compass.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>class Compass {
  /**
   * @name Compass
   * @constructor
   */
  constructor(){
    this.deviceAngleFromNorth = 0;
    this.angleTowardsDesiredLocation = 0;
    this.debug = false;

    this.init();
  }

  /**
   * Initializes the device orientation
   * @function
   */
  init(){
    //   check for device orientation support
    if (window.DeviceOrientationEvent) {
      window.addEventListener(
        'deviceorientation',
        this.deviceOrientationHandler.bind(this),
        false
      );
    } else {
      alert('no device orientation support');
    }
  }

  /**
   * handles changes created by the device orientation changes
   * @callback
   * @param {object} evt - the event object of the device orientation
   */
  deviceOrientationHandler(evt) {
    if (evt.webkitCompassHeading)
      //iphone
      this.deviceAngleFromNorth = 360 - evt.webkitCompassHeading;
    else if (evt.alpha)
      //android
      this.deviceAngleFromNorth = evt.alpha;
    else {
      console.log('compass direction not found');
    }

    this.deviceAngleFromNorth = Math.round(this.deviceAngleFromNorth);

    // update the rotation
    this.update();
  }

   /**
   * get the position of the user
   */
  getPosition() {
    return new Promise((resolve, reject) => {
      navigator.geolocation.getCurrentPosition(position => {
        if (position) {
          resolve(position);
        } else {
          reject('no position found');
        }
      });
    });
  }

  /**
   * Get the desired location
   */
  async getDesiredDirection() {
    const { data, position } = await this.getWeather();

    // get the best Index based on the fitness model
    let bestIndex = 0;
    let bestScore;

    data.list.forEach((item, idx) => {
      const tempK = item.main.feels_like;

      const fitness = this.calculateFitness(tempK);

      if (!bestScore) {
        bestScore = fitness;
      } else if (fitness &lt; bestScore) {
        bestScore = fitness;
        bestIndex = idx;
      } else {
        return;
      }
    });

    // calculate the angle to the most fit
    const bestFit = data.list[bestIndex];
    this.angleTowardsDesiredLocation = this.calculateAngle(
      position.coords.latitude,
      bestFit.coord.lat,
      position.coords.longitude,
      bestFit.coord.lon
    ) * (180/Math.PI);

    
    // DEBUGGING DIRECTION
    // data.list.forEach(item => {
    //   console.log(item.name, item.main.temp);
    // })
    console.log(bestFit, bestIndex);
    console.log("angle:", this.angleTowardsDesiredLocation)

    this.update();
  }

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Compass.html">Compass</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed Apr 22 2020 22:51:51 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
